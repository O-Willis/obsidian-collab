https://codemirror.net/try/?c=aW1wb3J0IHtiYXNpY1NldHVwfSBmcm9tICJjb2RlbWlycm9yIgppbXBvcnQge0RlY29yYXRpb24sIEVkaXRvclZpZXcsIFZpZXdQbHVnaW4sIFZpZXdVcGRhdGUsIE1hdGNoRGVjb3JhdG9yLCBXaWRnZXRUeXBlfSBmcm9tICJAY29kZW1pcnJvci92aWV3IgppbXBvcnQge0VkaXRvclN0YXRlLCBSYW5nZVNldEJ1aWxkZXJ9IGZyb20gIkBjb2RlbWlycm9yL3N0YXRlIgppbXBvcnQge2phdmFzY3JpcHR9IGZyb20gIkBjb2RlbWlycm9yL2xhbmctamF2YXNjcmlwdCIKCmNsYXNzIEhlYWRlcldpZGdldCBleHRlbmRzIFdpZGdldFR5cGUgewogIGNvbnN0cnVjdG9yKGxldmVsLCB0ZXh0KSB7CiAgICBzdXBlcigpOwogIH0KCiAgdG9ET00oKSB7CiAgICBjb25zdCBzcGFuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpOwogICAgc3Bhbi5jbGFzc05hbWUgPSBgY20taGVhZGVyIGNtLWhlYWRlci0ke3RoaXMubGV2ZWx9YDsKICAgIHNwYW4udGV4dENvbnRlbnQgPSB0aGlzLnRleHQ7CiAgICByZXR1cm4gc3BhbjsKICB9CgogIGlnbm9yZUV2ZW50KCkgewogICAgcmV0dXJuIGZhbHNlOwogIH0KfQoKY29uc3QgbWFya2Rvd25FbmhhbmNlbWVudHMgPSBWaWV3UGx1Z2luLmZyb21DbGFzcyhjbGFzcyB7CiAgY29uc3RydWN0b3IodmlldykgewogICAgdGhpcy5kZWNvcmF0aW9ucyA9IHRoaXMuY3JlYXRlRGVjb3JhdGlvbnModmlldyk7CiAgfQoKICB1cGRhdGUodXBkYXRlKSB7CiAgICBpZiAodXBkYXRlLmRvY0NoYW5nZWQgfHwgdXBkYXRlLnZpZXdwb3J0Q2hhbmdlZCkgewogICAgICB0aGlzLmRlY29yYXRpb25zID0gdGhpcy5jcmVhdGVEZWNvcmF0aW9ucyh1cGRhdGUudmlldyk7CiAgICB9CiAgfQogIGNyZWF0ZURlY29yYXRpb25zKHZpZXcpIHsKICAgIGNvbnN0IGJ1aWxkZXIgPSBuZXcgUmFuZ2VTZXRCdWlsZGVyCiAgICBmb3IgKGxldCB7IGZyb20sIHRvIH0gb2Ygdmlldy52aXNpYmxlUmFuZ2VzKSB7CiAgICAgIGZvciAobGV0IHBvcyA9IGZyb207IHBvcyA8PSB0bzspIHsKICAgICAgICBjb25zdCBsaW5lID0gdmlldy5zdGF0ZS5kb2MubGluZUF0KHBvcykKICAgICAgICBjb25zdCBoZWFkZXJNYXRjaCA9IGxpbmUudGV4dC5tYXRjaCgvXigjKylccysoLiopLykKICAgICAgICBpZiAoaGVhZGVyTWF0Y2gpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCJBZGRpbmcgJyIraGVhZGVyTWF0Y2grIicgdG8gJyIrbGluZSsiJyIpCiAgICAgICAgICBjb25zdCBsZXZlbCA9IGhlYWRlck1hdGNoWzFdLmxlbmd0aAogICAgICAgICAgY29uc3QgdGV4dCA9IGhlYWRlck1hdGNoWzJdCiAgICAgICAgICBjb25zdCBoZWFkZXJEZWNvcmF0aW9uID0gRGVjb3JhdGlvbi5saW5lKHsKICAgICAgICAgICAgYXR0cmlidXRlczogeyBjbGFzczogYEh5cGVyTUQtaGVhZGVyIEh5cGVyTUQtaGVhZGVyLSR7bGV2ZWx9YCB9CiAgICAgICAgICB9KQogICAgICAgICAgY29uc3Qgd2lkZ2V0ID0gbmV3IEhlYWRlcldpZGdldChsZXZlbCwgdGV4dCk7CiAgICAgICAgICBjb25zdCB3aWRnZXREZWNvcmF0aW9uID0gRGVjb3JhdGlvbi53aWRnZXQoewogICAgICAgICAgICB3aWRnZXQsCiAgICAgICAgICAgIHNpZGU6IC0xLCAvLyBQbGFjZSB3aWRnZXQgYXQgdGhlIHN0YXJ0IG9mIHRoZSBsaW5lCiAgICAgICAgICB9KQogICAgICAgICAgYnVpbGRlci5hZGQobGluZS5mcm9tLCBsaW5lLnRvLCB3aWRnZXREZWNvcmF0aW9uKQogICAgICAgICAgYnVpbGRlci5hZGQobGluZS5mcm9tLCBsaW5lLnRvLCBoZWFkZXJEZWNvcmF0aW9uKQogICAgICAgIH0KICAgICAgICBwb3MgPSBsaW5lLnRvICsgMQogICAgICB9CiAgICB9CiAgICByZXR1cm4gYnVpbGRlci5maW5pc2goKQogIH0KfSwgeyBkZWNvcmF0aW9uczogdiA9PiB2LmRlY29yYXRpb25zIH0pCgpuZXcgRWRpdG9yVmlldyh7CiAgZG9jOiAiIyBoMVxuIyMgaDJcbiMjIyBoM1xuIyMjIyBoNFxuIyMjIyMjIGg1XG4jIyMjIFByb2plY3QgTWlsZXN0b25lczpcbi0gWyBdIEltcGxlbWVudCBiYXNpYyBmdW5jdGlvbmFsaXR5LlxuLSBbIF0gQ3JlYXRlIFVuaXQgdGVzdHMuXG4tIFsgXSBQdWJsaXNoIHRoZSBwbHVnaW4gaW4gdGhlIG9mZmljaWFsIE9ic2lkaWFuIFJlcG9zaXRvcnkuXG4tIFsgXSBDcmVhdGUgR2l0aHViIGFjdGlvbnMgdG8gcHVibGlzaCBhdXRvbWF0aWNhbGx5LlxuIiwKICBleHRlbnNpb25zOiBbYmFzaWNTZXR1cCwgamF2YXNjcmlwdCgpLCBtYXJrZG93bkVuaGFuY2VtZW50c10sCiAgcGFyZW50OiBkb2N1bWVudC5ib2R5Cn0pCg==